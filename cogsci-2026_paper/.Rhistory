#| label: Load R libraries
#| echo: false
#| message: false
library(here)
library(osfr)
library(dplyr)
library(tidyr)
library(tidyverse)
library(zoo)
library(jsonlite)
library(clipr)
library(reticulate)
library(lmerTest) # show p value in lmer
np <- import("numpy")
#| label: Demographic data
#| include: false
#| echo: false
df.demographics <- list.files(here("demographic-data/"), pattern = "*.csv", full.names=TRUE) %>%
lapply(function(f) {
matrix_size <- gsub('.*_(\\dx\\d)\\.csv', '\\1', basename(f))
read.csv(f) %>%
mutate(Matrix.size = matrix_size)
}) %>%
bind_rows() %>%
filter(Status=="APPROVED")
overall_N <- nrow(df.demographics)
overall_mean_age <- mean(as.numeric(df.demographics$Age), na.rm=TRUE)
overall_median_age <- median(as.numeric(df.demographics$Age), na.rm=TRUE)
overall_sd_age <- sd(as.numeric(df.demographics$Age), na.rm=TRUE)
overall_age_range <- range(as.numeric(df.demographics$Age), na.rm=TRUE)
N_nationalities <- length(unique(df.demographics$Nationality))
N_languages <- length(unique(df.demographics$Language))
# Gender distribution
gender_counts <- table(df.demographics$Sex)
n_female <- gender_counts["Female"]
n_male <- gender_counts["Male"]
n_other <- sum(gender_counts[!names(gender_counts) %in% c("Female", "Male")], na.rm=TRUE)
df.demographics.group_summary <- df.demographics %>%
group_by(Matrix.size) %>%
summarise(N = n(),
mean_age = mean(as.numeric(Age), na.rm=TRUE),
sd_age = sd(as.numeric(Age), na.rm=TRUE),
min_age = min(as.numeric(Age), na.rm=TRUE),
max_age = max(as.numeric(Age), na.rm=TRUE))
group_N <- first(df.demographics.group_summary$N)
N_5x5 <- df.demographics.group_summary %>%
filter(Matrix.size=="5x5") %>%
pull(N)
#| label: Experiment configs that stay constant across participants
#| echo: false
#| include: false
EXPERIMENT_CONFIG <- list(
osf_id_4x4 = "Emfhw",
osf_id_5x5 = "Fraxt",
osf_id_6x6 = "jx48y",
osf_id_7x7 = "92jq7",
osf_id_8x8 = "Tx3h7",
key_mapping_4pos = c("d","f","j","k"),
key_mapping_5pos = c("s","d","f","j","k"),
key_mapping_6pos = c("s","d","f","j","k","l"),
key_mapping_7pos = c("a","s","d","f","j","k","l"),
key_mapping_8pos = c("a","s","d","f","j","k","l",";"),
n_blocks = 20,
rsi = 120,
error_feedback_duration = 200,
error_tone_duration = 100,
correct_feedback_duration = 200,
estimated_trial_duration = 500,
accuracy_threshold = 0.65,
rt_threshold = 1000
)
#| label: Original transition matrices
#| echo: false
#| include: false
# Shannon entropy (bits) of a single probability vector (skip zeros)
row_entropy <- function(prob_vec) {
p <- prob_vec[prob_vec > 0]
-sum(p * log2(p))
}
# Calculate positional entropy for each row in a transition matrix
positional_entropy <- function(mat) {
apply(mat, MARGIN=1, row_entropy)
}
transition_matrix_4x4 <- matrix(unlist(np$load(here("assets/transition-matrices/matrix_4x4.npy"))$tolist()), nrow=4, byrow=TRUE)
#| label: Original transition matrices
#| echo: false
#| include: false
# Shannon entropy (bits) of a single probability vector (skip zeros)
row_entropy <- function(prob_vec) {
p <- prob_vec[prob_vec > 0]
-sum(p * log2(p))
}
# Calculate positional entropy for each row in a transition matrix
positional_entropy <- function(mat) {
apply(mat, MARGIN=1, row_entropy)
}
transition_matrix_4x4 <- matrix(unlist(np$load(here("assets/transition-matrices/matrix_4x4.npy"))$tolist()), nrow=4, byrow=TRUE)
#| label: Load R libraries
#| echo: false
#| message: false
library(here)
library(osfr)
library(dplyr)
library(tidyr)
library(tidyverse)
library(zoo)
library(jsonlite)
library(clipr)
library(reticulate)
library(lmerTest) # show p value in lmer
np <- import("numpy")
#| label: Demographic data
#| include: false
#| echo: false
df.demographics <- list.files(here("demographic-data/"), pattern = "*.csv", full.names=TRUE) %>%
lapply(function(f) {
matrix_size <- gsub('.*_(\\dx\\d)\\.csv', '\\1', basename(f))
read.csv(f) %>%
mutate(Matrix.size = matrix_size)
}) %>%
bind_rows() %>%
filter(Status=="APPROVED")
overall_N <- nrow(df.demographics)
overall_mean_age <- mean(as.numeric(df.demographics$Age), na.rm=TRUE)
overall_median_age <- median(as.numeric(df.demographics$Age), na.rm=TRUE)
overall_sd_age <- sd(as.numeric(df.demographics$Age), na.rm=TRUE)
overall_age_range <- range(as.numeric(df.demographics$Age), na.rm=TRUE)
N_nationalities <- length(unique(df.demographics$Nationality))
N_languages <- length(unique(df.demographics$Language))
# Gender distribution
gender_counts <- table(df.demographics$Sex)
n_female <- gender_counts["Female"]
n_male <- gender_counts["Male"]
n_other <- sum(gender_counts[!names(gender_counts) %in% c("Female", "Male")], na.rm=TRUE)
df.demographics.group_summary <- df.demographics %>%
group_by(Matrix.size) %>%
summarise(N = n(),
mean_age = mean(as.numeric(Age), na.rm=TRUE),
sd_age = sd(as.numeric(Age), na.rm=TRUE),
min_age = min(as.numeric(Age), na.rm=TRUE),
max_age = max(as.numeric(Age), na.rm=TRUE))
group_N <- first(df.demographics.group_summary$N)
N_5x5 <- df.demographics.group_summary %>%
filter(Matrix.size=="5x5") %>%
pull(N)
#| label: Experiment configs that stay constant across participants
#| echo: false
#| include: false
EXPERIMENT_CONFIG <- list(
osf_id_4x4 = "Emfhw",
osf_id_5x5 = "Fraxt",
osf_id_6x6 = "jx48y",
osf_id_7x7 = "92jq7",
osf_id_8x8 = "Tx3h7",
key_mapping_4pos = c("d","f","j","k"),
key_mapping_5pos = c("s","d","f","j","k"),
key_mapping_6pos = c("s","d","f","j","k","l"),
key_mapping_7pos = c("a","s","d","f","j","k","l"),
key_mapping_8pos = c("a","s","d","f","j","k","l",";"),
n_blocks = 20,
rsi = 120,
error_feedback_duration = 200,
error_tone_duration = 100,
correct_feedback_duration = 200,
estimated_trial_duration = 500,
accuracy_threshold = 0.65,
rt_threshold = 1000
)
#| label: Original transition matrices
#| echo: false
#| include: false
# Shannon entropy (bits) of a single probability vector (skip zeros)
row_entropy <- function(prob_vec) {
p <- prob_vec[prob_vec > 0]
-sum(p * log2(p))
}
# Calculate positional entropy for each row in a transition matrix
positional_entropy <- function(mat) {
apply(mat, MARGIN=1, row_entropy)
}
transition_matrix_4x4 <- matrix(unlist(np$load(here("assets/transition-matrices/matrix_4x4.npy"))$tolist()), nrow=4, byrow=TRUE)
transition_matrix_4x4 <- matrix(unlist(np$load(here("assets/transition-matrices/matrix_4x4.npy"))$tolist()), nrow=4, byrow=TRUE)
transition_matrix_5x5 <- matrix(unlist(np$load(here("assets/transition-matrices/matrix_5x5.npy"))$tolist()), nrow=5, byrow=TRUE)
transition_matrix_4x4 <- matrix(unlist(np$load(here("assets/transition-matrices/matrix_4x4.npy"))), nrow=4, byrow=TRUE)
View(transition_matrix_4x4)
transition_matrix_5x5 <- matrix(unlist(np$load(here("assets/transition-matrices/matrix_5x5.npy"))), nrow=5, byrow=TRUE)
transition_matrix_6x6 <- matrix(unlist(np$load(here("assets/transition-matrices/matrix_6x6.npy"))), nrow=6, byrow=TRUE)
transition_matrix_7x7 <- matrix(unlist(np$load(here("assets/transition-matrices/matrix_7x7.npy"))), nrow=7, byrow=TRUE)
transition_matrix_8x8 <- matrix(unlist(np$load(here("assets/transition-matrices/matrix_8x8.npy"))), nrow=8, byrow=TRUE)
all_original_matrices <- list(
"4x4" = transition_matrix_4x4,
"5x5" = transition_matrix_5x5,
"6x6" = transition_matrix_6x6,
"7x7" = transition_matrix_7x7,
"8x8" = transition_matrix_8x8
)
all_positional_entropies <- lapply(all_original_matrices, positional_entropy)
all_positional_entropies_df <- lapply(names(all_positional_entropies), function(size) {
data.frame(
Matrix.size = size,
Position = 1:length(all_positional_entropies[[size]]),
Entropy = all_positional_entropies[[size]]
)
}) %>%
bind_rows()
pos_1_entropy <- all_positional_entropies_df %>%
group_by(Matrix.size) %>%
filter(Position==1) %>%
ungroup() %>%
summarize(range=range(Entropy), mean=mean(Entropy), sd=sd(Entropy))
pos_n_entropy <- all_positional_entropies_df %>%
group_by(Matrix.size) %>%
filter(Position==max(Position)) %>%
ungroup() %>%
summarize(range=range(Entropy), mean=mean(Entropy), sd=sd(Entropy))
entropy_gradient_summary <- all_positional_entropies_df %>%
group_by(Matrix.size) %>%
summarize(entropy_diffs = list(diff(Entropy))) %>%
ungroup() %>%
summarize(
range_diff = list(range(unlist(entropy_diffs))),
mean_diff = mean(unlist(entropy_diffs)),
sd_diff = sd(unlist(entropy_diffs))
)
install.packages("https://cran.r-project.org/src/contrib/Archive/dplyr/dplyr_1.0.10.tar.gz", repos = NULL, type = "source")
View(all_positional_entropies)
View(all_positional_entropies_df)
View(entropy_gradient_summary)
View(all_positional_entropies_df)
#| label: Retrieve data from OSF
#| echo: false
#| include: false
#| cache: true
files_4x4 <- osf_retrieve_node(EXPERIMENT_CONFIG$osf_id_4x4) %>%
osf_ls_files(n_max = Inf) %>%
osf_download(path = here("data/4x4-data"), conflicts="skip")
files_5x5 <- osf_retrieve_node(EXPERIMENT_CONFIG$osf_id_5x5) %>%
osf_ls_files(n_max = Inf) %>%
osf_download(path = here("data/5x5-data"), conflicts="skip")
files_6x6 <- osf_retrieve_node(EXPERIMENT_CONFIG$osf_id_6x6) %>%
osf_ls_files(n_max = Inf) %>%
osf_download(path = here("data/6x6-data"), conflicts="skip")
files_7x7 <- osf_retrieve_node(EXPERIMENT_CONFIG$osf_id_7x7) %>%
osf_ls_files(n_max = Inf) %>%
osf_download(path = here("data/7x7-data"), conflicts="skip")
files_8x8 <- osf_retrieve_node(EXPERIMENT_CONFIG$osf_id_8x8) %>%
osf_ls_files(n_max = Inf) %>%
osf_download(path = here("data/8x8-data"), conflicts="skip")
#| label: Bind all data together
#| echo: false
#| include: false
#| cache: true
df.raw <- list.files(here("data/"), pattern = "*.csv", full.names=TRUE, recursive=TRUE) %>%
.[!grepl("pilot-data", .)] %>%
lapply(read.csv) %>%
bind_rows()
#| label: Filter out unnecessary columns
#| echo: false
#| include: false
#| cache: true
df <- subset(df.raw, select=c(trial_index, subject_id, matrix_size, trials_per_block, total_trials, practice_trials, transition_matrix, conditional_entropies, phase, block, experiment_trial_type, trial_in_block, overall_trial, position, correct_key, response, correct, rt, conditional_entropy, surprisal, questionnaire_item))
#| label: Clean up data formatting
#| echo: false
#| include: false
#| cache: true
# Convert NA values
df <- df %>%
mutate(across(where(is.character), ~{
x <- .
x[x %in% c("NA", "na", "null", "NULL", "")] <- NA
x
}))
# Convert boolean values
df <- df %>%
mutate(across(where(is.character), ~ {
x <- tolower(.)
if (all(x %in% c("true", "false", NA))) {
as.logical(x)
} else {
.
}
}))
# Convert numeric values
df <- df %>%
mutate(across(where(is.character), ~ {
x <- .
is_num <- suppressWarnings(!is.na(as.numeric(x)) | is.na(x))
if (all(is_num)) as.numeric(x) else x
}))
# Fill down overall_trial, trial_in_block and block
df <- df %>%
group_by(subject_id) %>%
arrange(subject_id, row_number()) %>%
mutate(
overall_trial = if_else(
experiment_trial_type %in% c("feedback", "rsi"),
zoo::na.locf(overall_trial, na.rm = FALSE),  # Fill down
overall_trial  # Keep as-is
),
trial_in_block = if_else(
experiment_trial_type %in% c("feedback", "rsi"),
zoo::na.locf(trial_in_block, na.rm = FALSE),
trial_in_block
),
block = if_else(
experiment_trial_type %in% c("feedback", "rsi"),
zoo::na.locf(block, na.rm = FALSE),
block
)
) %>%
ungroup()
#| label: Sanity check for unique subject_ids, matrix size, total number of trials, practice trials, transition matrices, conditional entropies and sequences across subjects and conditions
#| echo: false
#| include: false
#| cache: true
unique_subjects <- unique(df$subject_id)
df %>%
group_by(matrix_size) %>%
summarize(
n_subjects = n_distinct(subject_id),
total_trials = unique(total_trials),
practice_trials = unique(practice_trials),
transition_matrix = list(unique(transition_matrix)),
conditional_entropies = list(unique(conditional_entropies)),
sequences = list(unique(position))
)
#| label: Separate practice, main and questionnaire sections
#| echo: false
#| include: false
#| cache: true
df.practice <- df[df$phase=="practice", ]
df.questionnaire <- df[df$phase=="questionnaire", ]
df <- df[df$phase=="main", ]
#| label: exclude-subjects
#| echo: false
#| include: false
#| cache: true
# Exclude subjects that
# 1. Made too many mistakes (more than 15%)
# 2. Have too long response time (look at mean, median and spread)
# -> exclude if too slow--the subject's median_rt > 1000ms
# -> or if too noisy--more than 20% of their trials are 3*mad higher than the subject's median_rt
accuracy_excluded_subjects <- df %>%
filter(matrix_size==8) %>%
filter(!is.na(correct)) %>%
group_by(subject_id) %>%
summarize(error_rate = mean(!correct)) %>%
filter(error_rate > 0.15) %>%
pull(subject_id)
rt_excluded_subjects <- df %>%
filter(
(experiment_trial_type == "stimulus" | experiment_trial_type == "retry")
& !is.na(rt)) %>%
group_by(subject_id) %>%
summarize(
median_rt = median(rt),
outlier_prop = mean(rt > median(rt) + 3*mad(rt))
) %>%
filter(median_rt > 1000 | outlier_prop > 0.2) %>%
pull(subject_id)
df <- df %>%
filter(!subject_id %in% accuracy_excluded_subjects & !subject_id %in% rt_excluded_subjects)
#| label: Make a new column for log(rt)
#| echo: false
#| include: false
#| cache: true
df <- df %>%
mutate(log_rt=log(rt))
#| label: Make a new column for previous position entropy
#| echo: false
#| include: false
#| cache: true
df <- df %>%
group_by(subject_id, block) %>%
mutate(previous_entropy=lag(conditional_entropy, 1))
#| label: Make a new column for prev_entropy_c
#| echo: false
#| include: false
#| cache: true
df <- df %>%
group_by(matrix_size) %>%
mutate(prev_entropy_c=previous_entropy-mean(previous_entropy, na.rm=TRUE))
#| label: Make a new column for surprisal_c
#| echo: false
#| include: false
#| cache: true
df <- df %>%
group_by(matrix_size) %>%
mutate(surprisal_c=surprisal-mean(surprisal, na.rm=TRUE))
#| label: Make a new column for is_repetition
#| echo: false
#| include: false
#| cache: true
df <- df %>%
mutate(is_repetition=(position==lag(position,1)))
#| label: Remove first trial of each block
#| echo: false
#| include: false
#| cache: true
df <- df %>%
group_by(block, subject_id) %>%
slice(2:n())
#| label: Make subset of df with only correct trials
#| echo: false
#| include: false
#| cache: true
df.correct <- df %>%
filter(correct)
#| label: Load R libraries
#| echo: false
#| message: false
library(osfr)
library(dplyr)
library(tidyr)
library(tidyverse)
library(zoo)
library(jsonlite)
library(clipr)
library(lme4)
library(lmerTest) # show p value in lmer
View(df)
data.m_h0 <- df %>%
group_by(matrix_size) %>%
filter(!is.infinite(log_rt))
View(data.m_h0)
# only final block first:
data.m_h1h2 <- df %>%
filter(block==EXPERIMENT_CONFIG[["n_blocks"]]-1, !is.na(log_rt)) %>%
group_by(matrix_size)
View(df)
View(data.m_h1h2)
View(df.correct)
data.m_h1h2.correct <- df.correct %>%
filter(block==EXPERIMENT_CONFIG[["n_blocks"]]-1) %>%
group_by(matrix_size)
View(data.m_h1h2.correct)
m_surprisal_x_entropy_rt <-
lmer(log_rt ~ surprisal_c * prev_entropy_c + is_repetition +
(surprisal_c * prev_entropy_c + is_repetition | subject_id) +
(1 | position),
data=data.m_h1h2,
REML=FALSE,
control=lmerControl(optimizer="bobyqa")) # can change
View(data.m_h0)
View(df)
df <- df %>%
group_by(subject_id) %>%
arrange(subject_id, row_number()) %>%
mutate(
overall_trial = if_else(
experiment_trial_type %in% c("feedback", "rsi"),
zoo::na.locf(overall_trial, na.rm = FALSE),  # Fill down
overall_trial  # Keep as-is
),
trial_in_block = if_else(
experiment_trial_type %in% c("feedback", "rsi"),
zoo::na.locf(trial_in_block, na.rm = FALSE),
trial_in_block
),
block = if_else(
experiment_trial_type %in% c("feedback", "rsi"),
zoo::na.locf(block, na.rm = FALSE),
block
)
) %>%
ungroup()
View(df)
#| label: Filter df down to only stimulus, non-retry trials
#| echo: false
#| include: false
df <- df %>%
filter(experiment_trial_type=="stimulus" & !is.na(rt))
View(df)
#| label: Load R libraries
#| echo: false
#| message: false
library(here)
library(osfr)
library(dplyr)
library(tidyr)
install.packages("dplyr")
#| label: Load R libraries
#| echo: false
#| message: false
library(here)
library(osfr)
library(dplyr)
library(tidyr)
#| label: Load R libraries
#| echo: false
#| message: false
library(here)
library(osfr)
library(dplyr)
library(tidyr)
#| label: Load R libraries
#| echo: false
#| message: false
library(here)
library(osfr)
library(dplyr)
library(tidyr)
