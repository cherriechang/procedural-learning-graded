#| label: Load R libraries
#| echo: false
#| message: false
library(osfr)
library(dplyr)
library(tidyr)
library(tidyverse)
library(zoo)
library(jsonlite)
library(clipr)
library(lme4)
library(lmerTest) # show p value in lmer
#| label: Load R libraries
#| echo: false
#| message: false
library(here)
library(osfr)
library(dplyr)
library(tidyr)
library(tidyverse)
library(zoo)
library(jsonlite)
library(clipr)
library(reticulate)
library(lmerTest) # show p value in lmer
np <- import("numpy")
#| label: Demographic data
#| include: false
#| echo: false
df.demographics <- list.files(here("demographic-data/"), pattern = "*.csv", full.names=TRUE) %>%
lapply(function(f) {
matrix_size <- gsub('.*_(\\dx\\d)\\.csv', '\\1', basename(f))
read.csv(f) %>%
mutate(Matrix.size = matrix_size)
}) %>%
bind_rows() %>%
filter(Status=="APPROVED")
overall_N <- nrow(df.demographics)
overall_mean_age <- mean(as.numeric(df.demographics$Age), na.rm=TRUE)
overall_median_age <- median(as.numeric(df.demographics$Age), na.rm=TRUE)
overall_sd_age <- sd(as.numeric(df.demographics$Age), na.rm=TRUE)
overall_age_range <- range(as.numeric(df.demographics$Age), na.rm=TRUE)
N_nationalities <- length(unique(df.demographics$Nationality))
N_languages <- length(unique(df.demographics$Language))
# Gender distribution
gender_counts <- table(df.demographics$Sex)
n_female <- gender_counts["Female"]
n_male <- gender_counts["Male"]
n_other <- sum(gender_counts[!names(gender_counts) %in% c("Female", "Male")], na.rm=TRUE)
df.demographics.group_summary <- df.demographics %>%
group_by(Matrix.size) %>%
summarise(N = n(),
mean_age = mean(as.numeric(Age), na.rm=TRUE),
sd_age = sd(as.numeric(Age), na.rm=TRUE),
min_age = min(as.numeric(Age), na.rm=TRUE),
max_age = max(as.numeric(Age), na.rm=TRUE))
group_N <- first(df.demographics.group_summary$N)
N_5x5 <- df.demographics.group_summary %>%
filter(Matrix.size=="5x5") %>%
pull(N)
#| label: Experiment configs that stay constant across participants
#| echo: false
#| include: false
EXPERIMENT_CONFIG <- list(
osf_id_4x4 = "Emfhw",
osf_id_5x5 = "Fraxt",
osf_id_6x6 = "jx48y",
osf_id_7x7 = "92jq7",
osf_id_8x8 = "Tx3h7",
key_mapping_4pos = c("d","f","j","k"),
key_mapping_5pos = c("s","d","f","j","k"),
key_mapping_6pos = c("s","d","f","j","k","l"),
key_mapping_7pos = c("a","s","d","f","j","k","l"),
key_mapping_8pos = c("a","s","d","f","j","k","l",";"),
n_blocks = 20,
rsi = 120,
error_feedback_duration = 200,
error_tone_duration = 100,
correct_feedback_duration = 200,
estimated_trial_duration = 500,
accuracy_threshold = 0.65,
rt_threshold = 1000
)
#| label: Original transition matrices
#| echo: false
#| include: false
# Shannon entropy (bits) of a single probability vector (skip zeros)
row_entropy <- function(prob_vec) {
p <- prob_vec[prob_vec > 0]
-sum(p * log2(p))
}
# Calculate positional entropy for each row in a transition matrix
positional_entropy <- function(mat) {
apply(mat, MARGIN=1, row_entropy)
}
transition_matrix_4x4 <- matrix(unlist(np$load(here("assets/transition-matrices/matrix_4x4.npy"))$tolist()), nrow=4, byrow=TRUE)
transition_matrix_4x4 <- matrix(unlist(np.load(here("assets/transition-matrices/matrix_4x4.npy"))$tolist()), nrow=4, byrow=TRUE)
transition_matrix_4x4 <- matrix(unlist(np_load(here("assets/transition-matrices/matrix_4x4.npy"))$tolist()), nrow=4, byrow=TRUE)
files_4x4 <- list.files("data/4x4-data")
files_5x5 <- list.files("data/5x5-data")
files_6x6 <- list.files("data/6x6-data")
files_7x7 <- list.files("data/7x7-data")
files_8x8 <- list.files("data/8x8-data")
df.raw <- list.files(here("data/"), pattern = "*.csv", full.names=TRUE, recursive=TRUE) %>%
.[!grepl("pilot-data", .)] %>%
lapply(read.csv) %>%
bind_rows()
#| label: Filter out unnecessary columns
#| echo: false
#| include: false
#| cache: true
df <- subset(df.raw, select=c(trial_index, subject_id, matrix_size, trials_per_block, total_trials, practice_trials, transition_matrix, conditional_entropies, phase, block, experiment_trial_type, trial_in_block, overall_trial, position, correct_key, response, correct, rt, conditional_entropy, surprisal, questionnaire_item))
#| label: Clean up data formatting
#| echo: false
#| include: false
# Convert NA values
df <- df %>%
mutate(across(where(is.character), ~{
x <- .
x[x %in% c("NA", "na", "null", "NULL", "")] <- NA
x
}))
# Convert boolean values
df <- df %>%
mutate(across(where(is.character), ~ {
x <- tolower(.)
if (all(x %in% c("true", "false", NA))) {
as.logical(x)
} else {
.
}
}))
# Convert numeric values
df <- df %>%
mutate(across(where(is.character), ~ {
x <- .
is_num <- suppressWarnings(!is.na(as.numeric(x)) | is.na(x))
if (all(is_num)) as.numeric(x) else x
}))
df <- df %>%
mutate(conditional_entropies = map(conditional_entropies, fromJSON)) %>%
mutate(transition_matrix = map(transition_matrix, fromJSON))
#| label: Fill down overall_trial, trial_in_block and block
#| echo: false
#| include: false
#| cache: true
df <- df %>%
group_by(subject_id) %>%
arrange(subject_id, row_number()) %>%
mutate(
overall_trial = if_else(
experiment_trial_type %in% c("feedback", "rsi"),
zoo::na.locf(overall_trial, na.rm = FALSE),  # Fill down
overall_trial  # Keep as-is
),
trial_in_block = if_else(
experiment_trial_type %in% c("feedback", "rsi"),
zoo::na.locf(trial_in_block, na.rm = FALSE),
trial_in_block
),
block = if_else(
experiment_trial_type %in% c("feedback", "rsi"),
zoo::na.locf(block, na.rm = FALSE),
block
)
) %>%
ungroup()
#| label: Load R libraries
#| echo: false
#| message: false
library(here)
library(osfr)
library(dplyr)
library(tidyr)
library(tidyverse)
library(zoo)
library(jsonlite)
library(clipr)
library(reticulate)
library(lmerTest) # show p value in lmer
np <- import("numpy")
#| label: Fill down overall_trial, trial_in_block and block
#| echo: false
#| include: false
#| cache: true
df <- df %>%
group_by(subject_id) %>%
arrange(subject_id, row_number()) %>%
mutate(
overall_trial = if_else(
experiment_trial_type %in% c("feedback", "rsi"),
zoo::na.locf(overall_trial, na.rm = FALSE),  # Fill down
overall_trial  # Keep as-is
),
trial_in_block = if_else(
experiment_trial_type %in% c("feedback", "rsi"),
zoo::na.locf(trial_in_block, na.rm = FALSE),
trial_in_block
),
block = if_else(
experiment_trial_type %in% c("feedback", "rsi"),
zoo::na.locf(block, na.rm = FALSE),
block
)
) %>%
ungroup()
#| label: Separate practice, main and questionnaire sections
#| echo: false
#| include: false
df.practice <- df[df$phase=="practice", ]
df.questionnaire <- df[df$phase=="questionnaire", ]
df <- df[df$phase=="main", ]
df <- df[, !(names(df) %in% c("transition_matrix", "conditional_entropies"))]
#| label: exclude-subjects
#| echo: false
#| include: false
#| cache: true
# Exclude subjects that
# 1. Made too many mistakes (more than 15%)
# 2. Have too long response time (look at mean, median and spread)
# -> exclude if too slow--the subject's median_rt > 1000ms
# -> or if too noisy--more than 20% of their trials are 3*mad higher than the subject's median_rt
accuracy_excluded_subjects <- df %>%
filter(matrix_size==8) %>%
filter(!is.na(correct)) %>%
group_by(subject_id) %>%
summarize(error_rate = mean(!correct)) %>%
filter(error_rate > 0.10) %>%
pull(subject_id)
rt_excluded_subjects <- df %>%
filter(
(experiment_trial_type == "stimulus" | experiment_trial_type == "retry")
& !is.na(rt)) %>%
group_by(subject_id) %>%
summarize(
median_rt = median(rt),
outlier_prop = mean(rt > median(rt) + 3*mad(rt))
) %>%
filter(median_rt > 1000 | outlier_prop > 0.2) %>%
pull(subject_id)
df <- df %>%
filter(!subject_id %in% accuracy_excluded_subjects & !subject_id %in% rt_excluded_subjects)
#| label: Filter df down to only stimulus, non-retry trials
#| echo: false
#| include: false
df <- df %>%
filter(experiment_trial_type=="stimulus" & !is.na(rt))
#| label: Remove first trial of each block and rows with infinite log_rt (rt==0)
#| echo: false
#| include: false
#| cache: true
df <- df %>%
filter(!is.infinite(log_rt)) %>%
group_by(block, subject_id) %>%
slice(2:n())
#| label: Remove first trial of each block
#| echo: false
#| include: false
#| cache: true
df <- df %>%
group_by(block, subject_id) %>%
slice(2:n())
#| label: Make a new column for log(rt), previous position entropy, prev_entropy_c, surprisal_c, is_repetition
#| echo: false
#| include: false
#| cache: true
df <- df %>%
mutate(log_rt=log(rt)) %>%
filter(!is.infinite(log_rt)) %>%
mutate(is_repetition=(position==lag(position,1))) %>%
group_by(subject_id, block) %>%
mutate(previous_entropy=lag(conditional_entropy, 1)) %>%
ungroup() %>%
group_by(matrix_size) %>%
mutate(prev_entropy_c=previous_entropy-mean(previous_entropy, na.rm=TRUE)) %>%
mutate(surprisal_c=surprisal-mean(surprisal, na.rm=TRUE)) %>%
ungroup()
#| label: Make subset of df with only correct trials
#| echo: false
#| include: false
df.correct <- df %>%
filter(correct)
df.m_h0 <- df %>%
group_by(matrix_size)
m_h0_rt <-
lmer(-log_rt ~ block + is_repetition + (block | subject_id) + (1 | position),
data=df.m_h0,
REML=FALSE,
control=lmerControl(optimizer="bobyqa")) # can change
summary(m_h0_rt)
#| label: Load R libraries
#| echo: false
#| message: false
library(here)
library(osfr)
library(dplyr)
library(tidyr)
library(tidyverse)
library(zoo)
library(jsonlite)
library(clipr)
library(reticulate)
library(lmerTest) # show p value in lmer
library(blme)
library(purrr)
library(broom.mixed)
install.packages("broom.mixed")
#| label: Load R libraries
#| echo: false
#| message: false
library(here)
library(osfr)
library(dplyr)
library(tidyr)
library(tidyverse)
library(zoo)
library(jsonlite)
library(clipr)
library(reticulate)
library(lmerTest) # show p value in lmer
library(blme)
library(purrr)
library(broom.mixed)
#| label: Load R libraries
#| echo: false
#| message: false
library(here)
library(osfr)
library(dplyr)
library(tidyr)
library(tidyverse)
library(zoo)
library(jsonlite)
library(clipr)
library(reticulate)
library(lmerTest) # show p value in lmer
library(blme)
library(purrr)
library(broom.mixed)
install.packages("broom.mixed")
